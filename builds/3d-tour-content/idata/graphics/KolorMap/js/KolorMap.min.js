(function(){var l=!0,n=null,q=!1;
KolorMap=function(a,e){function c(){var b=document.createElement("div");b.id="mapdiv_m7";b.style.display="none";document.body.appendChild(b);new mxn.Mapstraction("mapdiv_m7","microsoft7")}this.api=this.api=e;this.domElement=this.domElement=a;this.mxnMap=this.mxnMap=new mxn.Mapstraction(a,e);var d=0,j=new ktools.Map,g=q,f=new ktools.Map,m=n,o=n,s=n,u="",v=0,w="",x="FFFFFF",y=q,i="",k="",p="",t="",z=q;this.setMapContainer=this.setMapContainer=function(b){i=b};this.setPanoContainer=this.setPanoContainer=
function(b){k=b};this.setTourContainer=this.setTourContainer=function(b){p=b};this.setMapLayer=this.setMapLayer=function(b){t=b};this.getMxnMap=this.getMxnMap=function(){return this.mxnMap};this.getMarkers=this.getMarkers=function(){return j};this.getRadars=this.getRadars=function(){return f};this.activateMarkersAnimation=this.b=function(b){g=b};this.getActiveMarker=this.getActiveMarker=function(){return m};this.setActiveMarker=this.setActiveMarker=function(b,h,a){"undefined"==typeof h&&(h=l);"undefined"==
typeof a&&(a=l);this.getActiveRadar()&&this.getActiveRadar().hide();this.getActiveMarker()&&this.getActiveMarker().getAttribute("id")!=b&&this.getActiveMarker().closeBubble();g&&this.getActiveMarker()&&this.getActiveMarker().getAttribute("id")!=b&&this.getActiveMarker().stopMarkerAnimation(this.getActiveMarker().getAttribute("id"));b==n?(this.setActiveRadar(n),m=n):(m=this.getMarkers().item(b),o=this.getRadars().item(b),o!=n&&(this.getMxnMap().changeZoom.fire(),a?o.show():o.hide()),g&&m!=n&&m.startMarkerAnimation(b),
h&&m!=n&&this.getMxnMap().setCenter(m.location,{}))};this.setActiveRadar=this.setActiveRadar=function(b){o=b};this.getActiveRadar=this.getActiveRadar=function(){return o};this.setStartPoint=this.setStartPoint=function(b,h){s={};s.point=b;s.zoom=h};this.getStartPoint=this.getStartPoint=function(){return s};this.setMapPosition=this.setMapPosition=function(b){u=b};this.getMapPosition=this.getMapPosition=function(){return u};this.setMapSize=this.setMapSize=function(b){v=b};this.getMapSize=this.getMapSize=
function(){return v};this.setGraphicsUrl=this.setGraphicsUrl=function(b){w=b};this.getGraphicsUrl=this.getGraphicsUrl=function(){return w};this.setMapZorder=this.setMapZorder=function(b){d=b};this.getMapZorder=this.getMapZorder=function(){return d};this.setMapResizable=this.setMapResizable=function(b){y=b};this.getMapResizable=this.getMapResizable=function(){return y};this.setBgColor=this.setBgColor=function(b){x=b};this.getBgColor=this.getBgColor=function(){return x};this.geocodePosition=this.geocodePosition=
function(b,h,a,f){var d=this,e=this.api;"microsoft"==this.api&&(e="microsoft7",c());(new mxn.Geocoder(e,function(b){(typeof f=="undefined"||f)&&d.getMxnMap().setCenterAndZoom(b[0].point,d.getMxnMap().getZoom());h(b[0].point)},function(){a()})).geocode(b)};this.addRadar=this.addRadar=function(b,h,a){if("undefined"==typeof h)return n;void 0==a&&(a={quality:8,radius:8E3,color:"#FFFFFF",opacity:0.5,width:1,fillColor:"#FFFFFF",fillOpacity:0.3,heading:0,fov:90,linkToZoom:l});h=new mxn.LatLonPoint(h.lat,
h.lon);h=new mxn.Radar(h,a);h.setAttribute("id",b);this.getMxnMap().addRadar(h,q);f.add(b,h);a.linkToZoom&&this.getMxnMap().changeZoom.addHandler(function(b,h){var a=this.getActiveRadar();a!=n&&a.currentZoomLevel!=h.getZoom()&&(a.currentZoomLevel=h.getZoom(),KolorMap.util.rotation(a,a.center,a.currentViewHeading,this.getMxnMap()))},this);h.hide();return h};this.removeRadar=this.removeRadar=function(b){var h=f.item(b);"undefined"==typeof h||h==n||(this.getActiveRadar()==h&&this.setActiveRadar(n),f.remove(b))};
this.addMarker=this.addMarker=function(b,h,a,c,f,d,e,g,i,k){a=new mxn.Marker(a);"undefined"!=typeof e&&""!=e&&("label"==g?a.setLabel(e):"tooltip"==g?a.setInfoTooltip(e):a.setInfoBubble(e));"undefined"!=typeof i&&i&&a.setHover(i);"undefined"!=typeof c&&""!=c&&a.setIcon(c,f,d);"undefined"!=typeof k&&k&&a.setDraggable(k);a.setAttribute("id",b);a.setAttribute("plugName",h);this.getMxnMap().addMarker(a,q);j.add(b,a);return a};this.removeMarker=this.removeMarker=function(b){var a=j.item(b);"undefined"==
typeof a||a==n||(this.getActiveMarker()==a&&this.setActiveMarker(n,q,q),this.getMxnMap().removeMarker(a),j.remove(b))};this.addKmlOverlay=this.addKmlOverlay=function(b,a){"undefined"==typeof a&&(a=q);this.getMxnMap().addOverlay(b,a);if("microsoft7"!=this.api){var c=this.getMxnMap().getZoom();this.getMxnMap().setZoom(c)}};this.addImageOverlay=this.addImageOverlay=function(b,a,c,f,e,d,g,i){this.getMxnMap().addImageOverlay(b,a,c,e,f,g,d,i)};this.changeProvider=this.changeProvider=function(b,a){this.getMxnMap().swap(b,
a);this.getActiveRadar()&&(this.getActiveRadar().show(),this.setActiveRadar(KolorMap.util.rotation(this.getActiveRadar(),this.getActiveRadar().center,this.getActiveRadar().currentViewHeading,this.getActiveRadar().mapstraction)))};this.addControls=this.addControls=function(b,a,c,f,e,d){var g={};b&&(g.zoom="small");a&&(g.pan=l);c&&(g.scale=l);f&&(g.map_type=l);e&&(g.overview=l);d&&d.streetview&&(g.streetview=l);this.getMxnMap().addControls(g)};this.setMapType=this.setMapType=function(b){switch(strtolower(b)){case "satellite":this.getMxnMap().setMapType(mxn.Mapstraction.SATELLITE);
break;case "hybrid":this.getMxnMap().setMapType(mxn.Mapstraction.HYBRID);break;case "physical":this.getMxnMap().setMapType(mxn.Mapstraction.PHYSICAL);break;default:this.getMxnMap().setMapType(mxn.Mapstraction.ROAD)}};this.initMapSize=this.initMapSize=function(){this.getBgColor()||this.setBgColor("F2F2F2");var b="100%",a="100%",c="none",f="0px",e="0px";switch(this.getMapPosition()){case "right":b=this.getMapSize()+"%";a="100%";c="left";f=100-this.getMapSize()+"%";break;case "top":b="100%";a=this.getMapSize()+
"%";c="none";break;case "bottom":b="100%";a=this.getMapSize()+"%";c="none";e=100-this.getMapSize()+"%";break;default:b=this.getMapSize()+"%",a="100%",c="none"}jQuery("#"+i).css({width:b,height:a,"float":c,left:f,top:e,background:"#"+this.getBgColor(),position:"absolute"})};this.initMapLayer=this.initMapLayer=function(b){b&&(t=b);jQuery("#"+t).css({width:"100%",height:"100%",position:"relative"})};this.initResizableMap=this.initResizableMap=function(){z=l;var b=this.getMapPosition(),a=100-this.getMapSize();
this.getBgColor()||this.setBgColor("F2F2F2");var c=0;this.getMapResizable()&&(c=5);var f=jQuery("#"+p).width(),e=jQuery("#"+p).height(),g,d;switch(b){case "right":g="w";d="#"+i+" div.ui-resizable-handle { background: #"+this.getBgColor()+" url('"+this.getGraphicsUrl()+"resizey_vert.png') no-repeat center left; width: 5px; height: 100%; left: 0px; }";panoContainerCss="#"+p+" #"+k+" { width: "+a+"%; height: 100%; float: left; position: absolute; }";break;case "top":g="s";d="#"+i+" div.ui-resizable-handle { background: #"+
this.getBgColor()+" url('"+this.getGraphicsUrl()+"resizey_hori.png') no-repeat bottom center; width: 100%; height: 5px; bottom: 0px; }";panoContainerCss="#"+p+" #"+k+" { width: 100%; height: "+a+"% !important; top: "+this.getMapSize()+"%; float: none; position: absolute; }";break;case "bottom":g="n";d="#"+i+" div.ui-resizable-handle { background: #"+this.getBgColor()+" url('"+this.getGraphicsUrl()+"resizey_hori.png') no-repeat top center; width: 100%; height: 5px; top: 0px; }";panoContainerCss="#"+
p+" #"+k+" { width: 100%; height: "+a+"% !important; float: none; position: absolute; }";break;default:g="e",d="#"+i+" div.ui-resizable-handle { background: #"+this.getBgColor()+" url('"+this.getGraphicsUrl()+"resizey_vert.png') no-repeat center right; width: 5px; height: 100%; right: 0px; }",panoContainerCss="#"+p+" #"+k+" { width: "+a+"%; height: 100%; float: right; }"}jQuery("<style type='text/css'>#"+p+" { height: inherit; overflow: hidden; position: relative; }#"+p+":after { clear: both; }"+
panoContainerCss+"</style>").appendTo("head");("Explorer"!=kolorBrowserDetect.browser||8<kolorBrowserDetect.version)&&this.getMapResizable()&&jQuery("<style type='text/css'>"+d+"</style>").appendTo("head");("Explorer"!=kolorBrowserDetect.browser||8<kolorBrowserDetect.version)&&this.getMapResizable()&&jQuery("#"+i).resizable({handles:g,animate:q,ghost:q,containment:"#"+p,maxWidth:f,minWidth:10,maxHeight:e,minHeight:10});var a=this.forceResizeMapLayer([i]),j=0,m=0;jQuery("#"+k).resize();if(("Explorer"!=
kolorBrowserDetect.browser||8<kolorBrowserDetect.version)&&this.getMapResizable()){var o=this;a&&(j=a[0],m=a[1],jQuery("#"+i).on("resizestop",function(a,h){var f=jQuery("#"+p),e=100,d=100,i=j,r=m,A="0px",s="0px";switch(b){case "top":d=100*(h.element.height()/f.height());r=h.element.height();o.setMapSize(d);break;case "bottom":d=100*(h.element.height()/f.height());s=100-d+"%";r=h.element.height();o.setMapSize(d);break;case "right":e=100*(h.element.width()/f.width());A=100-e+"%";i=h.element.width();
o.setMapSize(e);break;default:e=100*(h.element.width()/f.width()),i=h.element.width(),o.setMapSize(e)}h.element.css({width:e+"%",height:d+"%",left:A,top:s});switch(b){case "right":g="w";jQuery("#"+k).css({width:100-e+"%",height:d+"%"});f=i-c;r=m;break;case "top":jQuery("#"+k).css("cssText","width: "+e+"%; height: "+(100-d)+"% !important; top: "+d+"%; position: absolute;");f=j;r-=c;break;case "bottom":jQuery("#"+k).css("cssText","width: "+e+"%; height: "+(100-d)+"% !important;");f=j;r-=c;break;default:g=
"e",jQuery("#"+k).css({width:100-e+"%",height:d+"%"}),f=i-c,r=m}o.getMxnMap().resizeTo(f,r);jQuery("#"+k).resize()}))}};this.updateResizableMapMaxSize=this.updateResizableMapMaxSize=function(){var b=jQuery("#"+p).width(),a=jQuery("#"+p).height();jQuery("#"+i).resizable("option","maxWidth",b);jQuery("#"+i).resizable("option","maxHeight",a)};this.openCloseMap=this.openCloseMap=function(b){var a=this.getMapPosition(),c=100-this.getMapSize(),d=z;if("open"==b[0]){d||(this.initMapSize(),this.initMapLayer(n),
this.initResizableMap());jQuery("#"+i+" div.ui-resizable-handle").css("display","block");jQuery(".mapSwapBox").css("display","block");switch(a){case "top":document.getElementById(i).style.height=this.getMapSize()+"%";jQuery("#"+k).css("cssText","height: "+c+"% !important; top: "+this.getMapSize()+"%;");document.getElementById(i).style.display="block";break;case "bottom":document.getElementById(i).style.height=this.getMapSize()+"%";jQuery("#"+k).css("cssText","height: "+c+"% !important;");document.getElementById(i).style.display=
"block";break;default:document.getElementById(i).style.width=this.getMapSize()+"%",document.getElementById(k).style.width=c+"%",document.getElementById(i).style.display="block"}this.forceResizeMapLayer([i])}else switch(jQuery("#"+i+" div.ui-resizable-handle").css("display","none"),jQuery(".mapSwapBox").css("display","none"),a){case "top":case "bottom":jQuery("#"+k).css("cssText","height: 100% !important; top:0;");document.getElementById(i).style.height="0%";document.getElementById(i).style.display=
"none";break;default:document.getElementById(k).style.width="100%",document.getElementById(i).style.width="0%",document.getElementById(i).style.display="none"}jQuery("#"+k).resize();d||(this.getActiveMarker()!=n&&this.getActiveMarker().location?this.getMxnMap().setCenterAndZoom(this.getActiveMarker().location,this.getStartPoint().zoom):this.getMxnMap().setCenterAndZoom(this.getStartPoint().point,this.getStartPoint().zoom))};this.addSwapSelector=this.addSwapSelector=function(b,a,c,d){var e=this.getMapPosition(),
f=a[0].element,g="";if(0<a.length)for(var j=0;j<a.length;j++)g+='<div class="mapDropDownItemDiv '+a[j].element+'" onclick="swapProvider(\''+b+"','"+a[j].element+"','"+a[j].provider+"');document.getElementById('mapDropDownOptionsDiv').style.display = 'none';\">"+a[j].name+"</div>";b="<\!-- MAP SWAP BOX --\><div class=\"mapSwapBox\"><div class=\"mapDropDownControl\" id=\"ddControl\" onclick=\"(document.getElementById('mapDropDownOptionsDiv').style.display == 'block') ? document.getElementById('mapDropDownOptionsDiv').style.display = 'none' : document.getElementById('mapDropDownOptionsDiv').style.display = 'block';\">"+
c+'<img class="mapDropDownArrow" src="'+this.getGraphicsUrl()+'map-arrow-down.png" /></div><div class="mapDropDownOptionsDiv" id="mapDropDownOptionsDiv">'+g+"</div></div>";jQuery(b).prependTo("#"+i);b="position: absolute;";if(d!=n)b+=d;else switch(e){case "top":case "bottom":b+=" left:50%;";break;default:b+=" top:50%;"}jQuery("<style type='text/css'>"+(".mapSwapBox{ width: 90px; margin: 5px; cursor: pointer; text-align: left; z-index: 1000; "+b+" }")+".mapDropDownControl{ direction: ltr; overflow: hidden; text-align: left; position: relative; font-family: Arial, Helvetica, sans-serif; -webkit-user-select: none; font-size: 13px; padding: 1px 6px; border-width: 1px; border-style: solid; border-color: rgb(113, 123, 135); border-image: initial; -webkit-box-shadow: rgba(0, 0, 0, 0.398438) 0px 2px 4px; box-shadow: rgba(0, 0, 0, 0.398438) 0px 2px 4px; color: rgb(0, 0, 0); font-weight: bold; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: rgb(255, 255, 255); background-position: initial initial; background-repeat: initial initial; z-index: 2; }.mapDropDownArrow{ -webkit-user-select: none; border-width: 0px; border-style: initial; border-color: initial; border-image: initial; padding: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; margin-top: -2px; position: absolute; right: 6px; top: 50%; width: 7px; height: 4px; }.mapDropDownOptionsDiv{ background-color: white; z-index: 0; padding-top: 2px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-width: 0px; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-style: initial; border-right-color: rgb(113, 123, 135); border-bottom-color: rgb(113, 123, 135); border-left-color: rgb(113, 123, 135); border-top-color: initial; border-image: initial; -webkit-box-shadow: rgba(0, 0, 0, 0.398438) 0px 2px 4px; box-shadow: rgba(0, 0, 0, 0.398438) 0px 2px 4px; position: relative; text-align: left; display: none; }.mapDropDownItemDiv{ font-family: Arial, Helvetica, sans-serif; -webkit-user-select: none; font-size: 13px; padding-top: 2px; padding-right: 5px; padding-bottom: 3px; padding-left: 5px; background-color: rgb(255, 255, 255); color: black; text-transform:capitalize; }.mapDropDownItemDiv:hover, .mapDropDownItemDiv.active{ background-color: rgb(235, 235, 235); }.mapDropDownControl:hover{ background: -webkit-linear-gradient(top,rgb(255,255,255),rgb(230,230,230)); }</style>").appendTo("head");
jQuery(".mapDropDownItemDiv."+f).addClass("active")};this.swapProvider=this.swapProvider=function(a){this.changeProvider(a[0],a[1]);jQuery(".mapDropDownItemDiv").removeClass("active");jQuery(".mapDropDownItemDiv."+a[0]).addClass("active");this.initMapLayer(a[0]);this.forceResizeMapLayer([i])};this.changeDirection=this.changeDirection=function(a){var c=parseFloat(a[0]),a=parseFloat(a[1]);this.getActiveRadar()!=n&&this.getActiveRadar().changeDirection(c,a)};this.changeCurrentMarker=this.changeCurrentMarker=
function(a){var c=l,c="string"==typeof a[3]?"true"==a[3].toLowerCase():Boolean(a[3]);this.setActiveMarker(a[0],c,l);void 0!=a[1]&&void 0!=a[2]&&this.changeDirection([a[1],a[2]])};this.unselectCurrentMarker=this.f=function(){this.setActiveMarker(n,q,q)};this.forceResizeMapLayer=this.forceResizeMapLayer=function(a){if(a&&a[0]){var c=jQuery("#"+a[0]).width(),a=jQuery("#"+a[0]).height();"Explorer"==kolorBrowserDetect.browser&&9>kolorBrowserDetect.version&&(c-=1,a-=1);this.getMxnMap().resizeTo(c,a);return[c,
a]}return q}};
KolorMap.util={rotation:function(a,e,c,d){d.removeRadar(a);a.currentViewHeading=c;var j=KolorMap.util.generatePolygonPoints(a,e);a.polyline=KolorMap.util.c(j,a,e,c+a.fov,d);d.addRadar(a,q);a.g&&a.activateClick();return a},generatePolygonPoints:function(a,e){var c=e.latConv(),d=e.lonConv(),j=[],g,f=a.heading+(a.fov-a.fovIncidence);for(g=a.heading-a.fovIncidence;g<f;g+=a.quality)j.push([Math.cos(KolorMap.util.a(g))/c,Math.sin(KolorMap.util.a(g))/d]);g>f&&(g=f-1,j.push([Math.cos(KolorMap.util.a(g))/c,
Math.sin(KolorMap.util.a(g))/d]));c=[];d=e.lat;g=e.lon;c.push(new mxn.LatLonPoint(d,g));f=a.radius/1E3;if(a.linkToZoom){f=0;switch(a.currentZoomLevel){case 23:case 22:case 21:f=5;break;case 20:f=10;break;case 19:f=20;break;case 18:f=50;break;case 17:f=100;break;case 16:f=200;break;case 15:f=500;break;case 14:f=1E3;break;case 13:f=2E3;break;case 12:f=2E3;break;case 11:f=5E3;break;case 10:f=1E4;break;case 9:f=2E4;break;case 8:f=5E4;break;case 7:f=1E5;break;case 6:f=2E5;break;case 5:f=5E5;break;case 4:case 3:case 2:case 1:case 0:f=
1E6;break;default:f=2E3}f/=1E3}for(var m=0;m<j.length;m++){var o=new mxn.LatLonPoint(d+f*j[m][0],g+f*j[m][1]);c.push(o)}c.push(new mxn.LatLonPoint(d,g));return c},c:function(a,e,c,d){for(var j=[],g=0;g<a.length;g++){var f=KolorMap.util.e(a[g],c,d);j.push(f)}a=new mxn.Polyline(j);a.setClosed(l);a.setColor(e.color);a.setOpacity(e.opacity);a.setWidth(e.width);a.setFillColor(e.fillColor);a.setFillOpacity(e.fillOpacity);a.api=e.api;return a},e:function(a,e,c){var d=KolorMap.util.distance(e,a),c=KolorMap.util.bearing(e,
a)-c;with(Math){var d=d/6371E3,a=KolorMap.util.a(e.lat),e=KolorMap.util.a(e.lon),j=KolorMap.util.a(c),c=asin(sin(a)*cos(d)+cos(a)*sin(d)*cos(j)),d=atan2(sin(j)*sin(d)*cos(a),cos(d)-sin(a)*sin(c));return new mxn.LatLonPoint(parseFloat(c*(180/PI)),parseFloat(((e-d+PI)%(2*PI)-PI)*(180/PI)))}},a:function(a){return a*(Math.PI/180)},d:function(a){return a*(180/Math.PI)},distance:function(a,e){var c=KolorMap.util.a(a.lat),d=KolorMap.util.a(e.lat),j=d-c,g=KolorMap.util.a(e.lon)-KolorMap.util.a(a.lon),d=Math.log(Math.tan(Math.PI/
4+d/2)/Math.tan(Math.PI/4+c/2)),c=isFinite(j/d)?j/d:Math.cos(c);Math.abs(g)>Math.PI&&(g=0<g?-(2*Math.PI-g):2*Math.PI+g);return 6371E3*Math.sqrt(j*j+c*c*g*g)},bearing:function(a,e){var c=KolorMap.util.a(e.lon)-KolorMap.util.a(a.lon),d=Math.log(Math.tan(Math.PI/4+KolorMap.util.a(e.lat)/2)/Math.tan(Math.PI/4+KolorMap.util.a(a.lat)/2));Math.abs(c)>Math.PI&&(c=0<c?-(2*Math.PI-c):2*Math.PI+c);c=Math.atan2(c,d);return c=(KolorMap.util.d(c)+360)%360}};})();